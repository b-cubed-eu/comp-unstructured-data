---
title: "Compare biodiversity indicators from the b3gbi package"
author: "Emma Cartuyvels, Ward Langeraert, Toon Van Daele"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
---

# Introduction

In this document we compare a selection of B-cubed biodiversity indicators between actual cube data and data from structured monitoring. For more information on both datasets check the *Explorative analysis from targets pipeline* html.

```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(collapse = TRUE, comment = "#>")

library(targets)
Sys.setenv(TAR_PROJECT = "biodiversity_indicators")

library(b3gbi)
library(ggplot2)
```

# Biodiversity indicators

## Total occurrences

### Map

```{r total occurrences map, fig.show="hold", out.width="50%"}
total_occ_map_abv <- tar_read(total_occ_map_abv)
p <- plot(total_occ_map_abv)
p + labs(title = paste0(p$labels$title, " - ABV"))

total_occ_map_birdcube <- tar_read(total_occ_map_cube)
p <- plot(total_occ_map_birdcube)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

What's interesting is that there are clearly certain areas in the cube that have much more occurrences than others. The ones on the coast are probably due to the gull data, the ones near and under Antwerp will need to be investigated further.

### Time series

```{r total occurrences time series, fig.show="hold", out.width="50%"}
total_occ_ts_abv <- tar_read(total_occ_ts_abv)
p <- plot(total_occ_ts_abv)
p + labs(title = paste0(p$labels$title, " - ABV"))

total_occ_ts_birdcube <- tar_read(total_occ_ts_cube)
p <- plot(total_occ_ts_birdcube)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

Both data sets show big differences in the number of observations over the years, this will probably impact other indicators if this is not corrected for.

## Observed richness

### Map 1 km²

```{robserved richness map 1km, fig.show="hold", out.width="50%"}
obs_richness_map_abv_1 <- tar_read(obs_richness_map_abv_1)
p <- plot(obs_richness_map_abv_1)
p + labs(title = paste0(p$labels$title, " - ABV"))

obs_richness_map_cube_1 <- tar_read(obs_richness_map_cube_1)
p <- plot(obs_richness_map_cube_1)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

### Map 10 km²

```{r observed richness map, fig.show="hold", out.width="50%"}
obs_richness_map_abv_10 <- tar_read(obs_richness_map_abv_10)
p <- plot(obs_richness_map_abv_10)
p + labs(title = paste0(p$labels$title, " - ABV"))

obs_richness_map_cube_10 <- tar_read(obs_richness_map_cube_10)
p <- plot(obs_richness_map_cube_10)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

### Time series

```{r observed richness time series, fig.show="hold", out.width="50%"}
obs_richness_ts_abv <- tar_read(obs_richness_ts_abv)
p <- plot(obs_richness_ts_abv)
p + labs(title = paste0(p$labels$title, " - ABV"))

obs_richness_ts_cube <- tar_read(obs_richness_ts_cube)
p <- plot(obs_richness_ts_cube)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

## Pielou evenness

### Map

```{r pielou evenness map, fig.show="hold", out.width="50%"}
pielou_evenness_map_abv <- tar_read(pielou_evenness_map_abv)
p <- plot(pielou_evenness_map_abv)
p + labs(title = paste0(p$labels$title, " - ABV"))

pielou_evenness_map_cube <- tar_read(pielou_evenness_map_cube)
p <- plot(pielou_evenness_map_cube)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

### Time series

```{r pielou evenness time series, fig.show="hold", out.width="50%"}
pielou_evenness_ts_abv <- tar_read(pielou_evenness_ts_abv)
p <- plot(pielou_evenness_ts_abv)
p + labs(title = paste0(p$labels$title, " - ABV"))

pielou_evenness_ts_cube <- tar_read(pielou_evenness_ts_cube)
p <- plot(pielou_evenness_ts_cube)
p + labs(title = paste0(p$labels$title, " - Cube"))
```

# Species-specific indicators {.tabset}

We chose three species to compare the indicators between the two data sets:

-   The species with the biggest increase according to the ABV: Cetti's warbler (*Cettia cetti*)
-   The species with the biggest decrease according to the ABV: Eurasian tree sparrow (*Passer montanus*)
-   A species with a very stable trend: Common nightingale (*Luscinia megarhynchos*)

## Cetti's Warbler

### Species occurrences

#### Map

```{r species occurrences map cettis warbler, fig.show="hold", out.width="50%"}
spec_occ_map_abv <- tar_read(spec_occ_map_abv)
p <- plot(spec_occ_map_abv, species = "Cettia cetti")
p

spec_occ_map_cube <- tar_read(spec_occ_map_cube)
p <- plot(spec_occ_map_cube, species = "Cettia cetti")
p
```

#### Time series

```{r species occurrences time series cettis warbler, fig.show="hold", out.width="50%"}
spec_occ_ts_abv <- tar_read(spec_occ_ts_abv)
p <- plot(spec_occ_ts_abv, species = "Cettia cetti")
p

spec_occ_ts_cube <- tar_read(spec_occ_ts_cube)
p <- plot(spec_occ_ts_cube, species = "Cettia cetti")
p
```

### Species range

#### Map

```{r species range map cettis warbler, fig.show="hold", out.width="50%"}
spec_range_map_abv <- tar_read(spec_range_map_abv)
p <- plot(spec_range_map_abv, species = "Cettia cetti")
p

spec_range_map_cube <- tar_read(spec_range_map_cube)
p <- plot(spec_range_map_cube, species = "Cettia cetti")
p
```

#### Time series

```{r species range time series cettis warbler, fig.show="hold", out.width="50%"}
spec_range_ts_abv <- tar_read(spec_range_ts_abv)
p <- plot(spec_range_ts_abv, species = "Cettia cetti")
p

spec_range_ts_cube <- tar_read(spec_range_ts_cube)
p <- plot(spec_range_ts_cube, species = "Cettia cetti")
p
```

## Eurasian tree sparrow

### Species occurrences

#### Map

```{r species occurrences map Eurasian tree sparrow, fig.show="hold", out.width="50%"}
spec_occ_map_abv <- tar_read(spec_occ_map_abv)
p <- plot(spec_occ_map_abv, species = "Passer montanus")
p

spec_occ_map_cube <- tar_read(spec_occ_map_cube)
p <- plot(spec_occ_map_cube, species = "Passer montanus")
p
```

#### Time series

```{r species occurrences time series Eurasian tree sparrow, fig.show="hold", out.width="50%"}
spec_occ_ts_abv <- tar_read(spec_occ_ts_abv)
p <- plot(spec_occ_ts_abv, species = "Passer montanus")
p

spec_occ_ts_cube <- tar_read(spec_occ_ts_cube)
p <- plot(spec_occ_ts_cube, species = "Passer montanus")
p
```

### Species range

#### Map

```{r species range map Eurasian tree sparrow, fig.show="hold", out.width="50%"}
spec_range_map_abv <- tar_read(spec_range_map_abv)
p <- plot(spec_range_map_abv, species = "Passer montanus")
p

spec_range_map_cube <- tar_read(spec_range_map_cube)
p <- plot(spec_range_map_cube, species = "Passer montanus")
p
```

#### Time series

```{r species range time series Eurasian tree sparrow, fig.show="hold", out.width="50%"}
spec_range_ts_abv <- tar_read(spec_range_ts_abv)
p <- plot(spec_range_ts_abv, species = "Passer montanus")
p

spec_range_ts_cube <- tar_read(spec_range_ts_cube)
p <- plot(spec_range_ts_cube, species = "Passer montanus")
p
```

## Common nightingale

### Species occurrences

#### Map

```{r species occurrences map Common nightingale, fig.show="hold", out.width="50%"}
spec_occ_map_abv <- tar_read(spec_occ_map_abv)
p<- plot(spec_occ_map_abv, species = "Luscinia megarhynchos")
p

spec_occ_map_cube <- tar_read(spec_occ_map_cube)
p <- plot(spec_occ_map_cube, species = "Luscinia megarhynchos")
p
```

#### Time series

```{r species occurrences time series Common nightingale, fig.show="hold", out.width="50%"}
spec_occ_ts_abv <- tar_read(spec_occ_ts_abv)
p <- plot(spec_occ_ts_abv, species = "Luscinia megarhynchos")
p

spec_occ_ts_cube <- tar_read(spec_occ_ts_cube)
p <- plot(spec_occ_ts_cube, species = "Luscinia megarhynchos")
p
```

### Species range

#### Map

```{r species range map Common nightingale, fig.show="hold", out.width="50%"}
spec_range_map_abv <- tar_read(spec_range_map_abv)
p <- plot(spec_range_map_abv, species = "Luscinia megarhynchos")
p

spec_range_map_cube <- tar_read(spec_range_map_cube)
p <- plot(spec_range_map_cube, species = "Luscinia megarhynchos")
p
```

#### Time series

```{r species range time series Common nightingale, fig.show="hold", out.width="50%"}
spec_range_ts_abv <- tar_read(spec_range_ts_abv)
p <- plot(spec_range_ts_abv, species = "Luscinia megarhynchos")
p

spec_range_ts_cube <- tar_read(spec_range_ts_cube)
p <- plot(spec_range_ts_cube, species = "Luscinia megarhynchos")
p
```

