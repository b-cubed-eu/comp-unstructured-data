---
title: "Standardisation"
author: "Emma Cartuyvels, Ward Langeraert, Toon Van Daele"
date: "`r Sys.Date()`" 
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(collapse = TRUE, comment = "#>")

library(targets)
Sys.setenv(TAR_PROJECT = "standardisation")

library(ggplot2)
library(ggpubr)
library(dplyr)
library(ggforce)
library(crosstalk)
library(DT)
library(plotly)
```

```{r consistent colors}
# Create a custom color scale
library(RColorBrewer)
my_colors <- brewer.pal(5, "Dark2")
names(my_colors) <- c("Very rare", "Rare", "Common",
                      "Very common", "Extremely common")
col_scale <- scale_color_manual(name = "Category",
                                values = my_colors)
fill_scale <- scale_fill_manual(name = "Category",
                                values = my_colors)
```

## Trend comparison {.tabset}

### No filter
```{r}
selected_species <- c("Spinus spinus", "Dendrocoptes medius",
                      "Pyrrhula pyrrhula")

tar_read(trend_comp_0) |>
  mutate(selected_species = ifelse(species %in% selected_species,
                                   "yes", "no")) |> 
  filter(id_spat_res == "1km",
         time_period == "cyclus") |>
  ggplot(aes(x = correlation, fill = category, alpha = selected_species)) +
  geom_histogram() +
  xlim(-1, 1) +
  fill_scale +
  labs(x = "Correlation",
       y = "Number of species")
```


### Standardized for total observations per cycle
```{r}
tar_read(trend_comp_3) |>
  filter(id_spat_res == "1km",
         time_period == "cyclus",
         id_filter_per == "cyclus") |>
  ggplot(aes(x = correlation, fill = category)) +
  geom_histogram() +
  xlim(-1, 1) +
  fill_scale +
  labs(x = "Correlation",
       y = "Number of species")

```

### Standardized for order
```{r}
tar_read(trend_comp_order) |>
  filter(id_spat_res == "1km",
         time_period == "cyclus") |>
  ggplot(aes(x = correlation, fill = category)) +
  geom_histogram() +
  xlim(-1, 1) +
  fill_scale +
  labs(x = "Correlation",
       y = "Number of species")
```

### Standardized for family
```{r}
tar_read(trend_comp_family) |>
  filter(id_spat_res == "1km",
         time_period == "cyclus") |>
  ggplot(aes(x = correlation, fill = category)) +
  geom_histogram() +
  xlim(-1, 1) +
  fill_scale +
  labs(x = "Correlation",
       y = "Number of species")
```

### Standardized for genus
```{r}
tar_read(trend_comp_genus) |>
  filter(id_spat_res == "1km",
         time_period == "cyclus") |>
  ggplot(aes(x = correlation, fill = category)) +
  geom_histogram() +
  xlim(-1, 1) +
  fill_scale +
  labs(x = "Correlation",
       y = "Number of species")
```







